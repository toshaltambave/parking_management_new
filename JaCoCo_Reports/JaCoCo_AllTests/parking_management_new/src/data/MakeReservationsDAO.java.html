<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>MakeReservationsDAO.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Merged (Apr 28, 2019 10:09:51 PM)</a> &gt; <a href="../../index.html" class="el_group">parking_management_new</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">data</a> &gt; <span class="el_source">MakeReservationsDAO.java</span></div><h1>MakeReservationsDAO.java</h1><pre class="source lang-java linenums">package data;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;

import javax.servlet.http.HttpSession;

import model.*;
import util.SQLConnection;

<span class="nc" id="L14">public class MakeReservationsDAO{</span>
	
<span class="fc" id="L16">	static SQLConnection DBMgr = SQLConnection.getInstance();</span>
//	public static void StoreReservationsInDB (Reservation reservations,String queryString) {
//		Statement stmt = null;
//		Connection conn = SQLConnection.getDBConnection();  
//		try {
//			stmt = conn.createStatement();
//			String insertReservation = queryString + &quot; VALUES ('&quot;  
//					+ reservations.getUserID()  + &quot;','&quot;
//					+ reservations.getSpotUID() + &quot;','&quot;	
//					+ reservations.getStartTime() + &quot;','&quot;	
//					+ reservations.getEndTime() + &quot;','&quot;
//					+ reservations.getNoShow() + &quot;','&quot;
//					+ reservations.getOverStay() + &quot;','&quot;
//					+ reservations.getCart() + &quot;','&quot;
//					+ reservations.getCamera() + &quot;','&quot;
//					+ reservations.getHistory() + &quot;'&quot; + ')';
//			stmt.executeUpdate(insertReservation);	
//			conn.commit(); 
//		} catch (SQLException e) {
//			e.printStackTrace();
//		} finally {
//			try {
//				conn.close();
//				stmt.close();
//			} catch (SQLException e) {
//				e.printStackTrace();
//			}};
//	}
//	public static ArrayList&lt;ReservationsHelper&gt; GetReservationsByName (String firstName, String lastName) {
//		ArrayList&lt;ReservationsHelper&gt; ReservationsByName = new ArrayList&lt;ReservationsHelper&gt;();
//		Statement stmt = null;
//		Connection conn = SQLConnection.getDBConnection();
//		try{
//			stmt=conn.createStatement();
//			String queryString=&quot;SELECT r.Reservation_Id,s.UserName,s_u.LastName,p_a.Area_Name, p.Floor_Number,p.Spot_Id,r.Start_Time,r.End_Time&quot;
//							+&quot;from reservations as r&quot;
//							+&quot;Inner join system_users as s on r.User_ID=s.User_ID&quot;
//							+&quot;Inner join user_details as s_u on r.User_ID=s_u.User_ID&quot;
//							+&quot;Inner join parking_spots as p on r.Spot_UID=p.Spot_UID&quot;
//							+&quot;Inner join parking_area as p_a on p.Area_Id=p_a.Area_Id&quot;
//							+&quot;where s_u.FirstName=&quot;+firstName+&quot;and s_u.LastName=&quot;+lastName+&quot;;&quot;;
//			ResultSet reservationList = stmt.executeQuery(queryString);
//			while (reservationList.next()) {
//				ReservationsHelper reservation = new ReservationsHelper();
//				reservation.setReservationID(reservationList.getInt(&quot;Reservation_Id&quot;));
//				reservation.setUserName(reservationList.getString(&quot;UserName&quot;));
//				reservation.setLastName(reservationList.getString(&quot;LastName&quot;));
//				reservation.setAreaName(reservationList.getString(&quot;Area_Name&quot;));
//				reservation.setFloor_Number(reservationList.getInt(&quot;Floor_Number&quot;));
//				reservation.setSpot_Id(reservationList.getInt(&quot;Spot_Id&quot;));
//				reservation.setStart_Time(reservationList.getString(&quot;Start_Time&quot;));
//				reservation.setEnd_Time(reservationList.getString(&quot;End_Time&quot;));
//				ReservationsByName.add(reservation);	
//			
//			}
//		}catch (SQLException e) {
//			e.printStackTrace();
//		} finally {
//			try {
//				conn.close();
//				stmt.close();
//			} catch (SQLException e) {
//				e.printStackTrace();
//			}
//		}
//		return ReservationsByName;
//	}
	
//	public static ArrayList&lt;ReservationsHelper&gt; GetReservationsByReservationId (Integer reservation_Id) {
//		ArrayList&lt;ReservationsHelper&gt; ReservationsById = new ArrayList&lt;ReservationsHelper&gt;();
//		Statement stmt = null;
//		Connection conn = SQLConnection.getDBConnection();
//		try{
//			stmt=conn.createStatement();
//			String queryString=&quot;SELECT r.Reservation_Id,s.UserName,s_u.LastName,p_a.Area_Name, p.Floor_Number,p.Spot_Id,r.Start_Time,r.End_Time&quot;
//							+&quot;from reservations as r&quot;
//							+&quot;Inner join system_users as s on r.User_ID=s.User_ID&quot;
//							+&quot;Inner join user_details as s_u on r.User_ID=s_u.User_ID&quot;
//							+&quot;Inner join parking_spots as p on r.Spot_UID=p.Spot_UID&quot;
//							+&quot;Inner join parking_area as p_a on p.Area_Id=p_a.Area_Id&quot;
//							+&quot;where r.Reservation_Id=&quot;+reservation_Id+&quot;;&quot;;
//			ResultSet reservationList = stmt.executeQuery(queryString);
//			while (reservationList.next()) {
//				ReservationsHelper reservation = new ReservationsHelper();
//				reservation.setReservationID(reservationList.getInt(&quot;Reservation_Id&quot;));
//				reservation.setUserName(reservationList.getString(&quot;UserName&quot;));
//				reservation.setLastName(reservationList.getString(&quot;LastName&quot;));
//				reservation.setAreaName(reservationList.getString(&quot;Area_Name&quot;));
//				reservation.setFloor_Number(reservationList.getInt(&quot;Floor_Number&quot;));
//				reservation.setSpot_Id(reservationList.getInt(&quot;Spot_Id&quot;));
//				reservation.setStart_Time(reservationList.getString(&quot;Start_Time&quot;));
//				reservation.setEnd_Time(reservationList.getString(&quot;End_Time&quot;));
//				ReservationsById.add(reservation);	
//			
//			}
//		}catch (SQLException e) {
//			e.printStackTrace();
//		} finally {
//			try {
//				conn.close();
//				stmt.close();
//			} catch (SQLException e) {
//				e.printStackTrace();
//			}
//		}
//		return ReservationsById;
//	}
	
	public static ArrayList&lt;ReservationsHelper&gt; GetReservationsByReservationDate (String current_date) {
<span class="fc" id="L125">		ArrayList&lt;ReservationsHelper&gt; ReservationsByDate = new ArrayList&lt;ReservationsHelper&gt;();</span>
<span class="fc" id="L126">		Statement stmt = null;</span>
<span class="fc" id="L127">		Connection conn = SQLConnection.getDBConnection();</span>
		try{
<span class="fc" id="L129">			stmt=conn.createStatement();</span>
<span class="fc" id="L130">			String queryString=&quot;SELECT r.Reservation_Id,s.UserName,s_u.LastName,p_a.Area_Name, p.Floor_Number,p.Spot_Id,r.Start_Time,r.End_Time, r.NoShow, r.OverStay &quot;</span>
							+&quot;from reservations as r &quot;
							+&quot;Inner join system_users as s on r.User_ID=s.User_ID &quot;
							+&quot;Inner join user_details as s_u on r.User_ID=s_u.User_ID &quot;
							+&quot;Inner join parking_spots as p on r.Spot_UID=p.Spot_UID &quot;
							+&quot;Inner join parking_area as p_a on p.Area_Id=p_a.Area_Id;&quot;;
							//+&quot;where r.Start_Time &gt;=&quot;+current_date+&quot;;&quot;;
<span class="fc" id="L137">			ResultSet reservationList = stmt.executeQuery(queryString);</span>
<span class="fc bfc" id="L138" title="All 2 branches covered.">			while (reservationList.next()) {</span>
<span class="fc" id="L139">				ReservationsHelper reservation = new ReservationsHelper();</span>
<span class="fc" id="L140">				reservation.setReservationID(reservationList.getInt(&quot;Reservation_Id&quot;));</span>
<span class="fc" id="L141">				reservation.setUserName(reservationList.getString(&quot;UserName&quot;));</span>
<span class="fc" id="L142">				reservation.setLastName(reservationList.getString(&quot;LastName&quot;));</span>
<span class="fc" id="L143">				reservation.setAreaName(reservationList.getString(&quot;Area_Name&quot;));</span>
<span class="fc" id="L144">				reservation.setFloor_Number(reservationList.getInt(&quot;Floor_Number&quot;));</span>
<span class="fc" id="L145">				reservation.setSpot_Id(reservationList.getInt(&quot;Spot_Id&quot;));</span>
<span class="fc" id="L146">				reservation.setStart_Time(reservationList.getString(&quot;Start_Time&quot;));</span>
<span class="fc" id="L147">				reservation.setEnd_Time(reservationList.getString(&quot;End_Time&quot;));</span>
<span class="fc" id="L148">				reservation.setisNoShow(reservationList.getInt(&quot;NoShow&quot;));</span>
<span class="fc" id="L149">				reservation.setisOverDue(reservationList.getInt(&quot;OverStay&quot;));</span>
<span class="fc" id="L150">				ReservationsByDate.add(reservation);			</span>
			}
<span class="fc" id="L152">			conn.close();</span>
<span class="fc" id="L153">			stmt.close();</span>
<span class="pc" id="L154">		}catch (SQLException e) {</span>
<span class="nc" id="L155">			e.printStackTrace();</span>
		} 
<span class="fc" id="L157">		return ReservationsByDate;</span>
	}
	
	public static ArrayList&lt;ReservationsHelper&gt; GetReservationsByReservationNoShow (String current_date) {
<span class="fc" id="L161">		ArrayList&lt;ReservationsHelper&gt; ReservationsNoShow = new ArrayList&lt;ReservationsHelper&gt;();</span>
<span class="fc" id="L162">		Statement stmt = null;</span>
<span class="fc" id="L163">		Connection conn = SQLConnection.getDBConnection();</span>
		try{
<span class="fc" id="L165">			stmt=conn.createStatement();</span>
<span class="fc" id="L166">			String queryString=&quot;SELECT r.Reservation_Id,s.UserName,s_u.LastName,p_a.Area_Name, p.Floor_Number,p.Spot_Id,r.Start_Time,r.End_Time,r.NoShow,r.OverStay &quot;</span>
							+&quot;from reservations as r &quot;
							+&quot;Inner join system_users as s on r.User_ID=s.User_ID &quot;
							+&quot;Inner join user_details as s_u on r.User_ID=s_u.User_ID &quot;
							+&quot;Inner join parking_spots as p on r.Spot_UID=p.Spot_UID &quot;
							+&quot;Inner join parking_area as p_a on p.Area_Id=p_a.Area_Id;&quot;;
//							+&quot;where r.End_Time &lt;='&quot;+current_date+&quot;';&quot;;
<span class="fc" id="L173">			ResultSet reservationList = stmt.executeQuery(queryString);</span>
<span class="fc bfc" id="L174" title="All 2 branches covered.">			while (reservationList.next()) {</span>
<span class="fc" id="L175">				ReservationsHelper reservation = new ReservationsHelper();</span>
<span class="fc" id="L176">				reservation.setReservationID(reservationList.getInt(&quot;Reservation_Id&quot;));</span>
<span class="fc" id="L177">				reservation.setUserName(reservationList.getString(&quot;UserName&quot;));</span>
<span class="fc" id="L178">				reservation.setLastName(reservationList.getString(&quot;LastName&quot;));</span>
<span class="fc" id="L179">				reservation.setAreaName(reservationList.getString(&quot;Area_Name&quot;));</span>
<span class="fc" id="L180">				reservation.setFloor_Number(reservationList.getInt(&quot;Floor_Number&quot;));</span>
<span class="fc" id="L181">				reservation.setSpot_Id(reservationList.getInt(&quot;Spot_Id&quot;));</span>
<span class="fc" id="L182">				reservation.setStart_Time(reservationList.getString(&quot;Start_Time&quot;));</span>
<span class="fc" id="L183">				reservation.setEnd_Time(reservationList.getString(&quot;End_Time&quot;));</span>
<span class="fc" id="L184">				reservation.setisNoShow(reservationList.getInt(&quot;NoShow&quot;));</span>
<span class="fc" id="L185">				reservation.setisOverDue(reservationList.getInt(&quot;OverStay&quot;));</span>
<span class="fc" id="L186">				ReservationsNoShow.add(reservation);			</span>
			}
<span class="fc" id="L188">			conn.close();</span>
<span class="fc" id="L189">			stmt.close();</span>
<span class="pc" id="L190">		}catch (SQLException e) {</span>
<span class="nc" id="L191">			e.printStackTrace();</span>
		} 
<span class="fc" id="L193">		return ReservationsNoShow;</span>
	}
 
	public static Boolean SetNoShow(Integer reservationID, Integer user_id){
<span class="fc" id="L197">	 Statement stmt = null;</span>
<span class="fc" id="L198">	 Connection conn = SQLConnection.getDBConnection();</span>
	 try{
		 	
<span class="fc" id="L201">			stmt=conn.createStatement();</span>
<span class="fc" id="L202">			String fetchqueryString=&quot;select NoShow from reservations where Reservation_Id=&quot;+reservationID+&quot;;&quot;;</span>
<span class="fc" id="L203">			ResultSet rs = stmt.executeQuery(fetchqueryString);</span>
<span class="pc bpc" id="L204" title="1 of 2 branches missed.">			if(rs.next()) </span>
			{			
<span class="fc" id="L206">				int NoShow = rs.getInt(&quot;NoShow&quot;);</span>
<span class="fc bfc" id="L207" title="All 2 branches covered.">				if(NoShow == 0)</span>
				{
<span class="fc" id="L209">					NoShow = 1;</span>
<span class="fc" id="L210">				}</span>
				else
				{
<span class="fc" id="L213">					NoShow = 0;</span>
				}			
<span class="fc" id="L215">				String queryString=&quot;update reservations set NoShow=&quot;+NoShow+&quot; where Reservation_Id=&quot;+reservationID+&quot;;&quot;;</span>
<span class="fc" id="L216">				stmt.executeUpdate(queryString);</span>
<span class="fc" id="L217">				conn.commit();</span>
<span class="fc" id="L218">				String queryString1=&quot;select count(*) AS Count from reservations where reservations.User_Id=&quot;+user_id+&quot; and reservations.NoShow=1&quot;;</span>
<span class="fc" id="L219">				ResultSet count=stmt.executeQuery(queryString1);</span>
<span class="fc" id="L220">				count.next();</span>
<span class="fc" id="L221">				Integer totalCount = count.getInt(&quot;Count&quot;);</span>
<span class="fc bfc" id="L222" title="All 2 branches covered.">				if (totalCount&gt;2){</span>
<span class="fc" id="L223">					String queryString2=&quot;Update System_users set isRevoked=1,comment=&quot; +&quot;'No Show Violation'&quot;+&quot; where user_id=&quot;+user_id+&quot;;&quot;;</span>
<span class="fc" id="L224">					stmt.executeUpdate(queryString2);</span>
<span class="fc" id="L225">				}</span>
				else
				{
<span class="fc" id="L228">					String queryString2=&quot;Update System_users set isRevoked=0,comment=&quot; +&quot;''&quot;+&quot; where user_id=&quot;+user_id+&quot;;&quot;;</span>
<span class="fc" id="L229">					stmt.executeUpdate(queryString2);</span>
				}
<span class="fc" id="L231">				conn.commit();</span>
<span class="fc" id="L232">			}</span>
			else
			{
<span class="nc" id="L235">				System.out.println(&quot;Do Nothing.&quot;);</span>
			}	
<span class="fc" id="L237">			conn.close();</span>
<span class="fc" id="L238">			stmt.close();</span>
<span class="pc" id="L239">	 }catch (SQLException e) {</span>
<span class="nc" id="L240">		 e.printStackTrace();</span>
<span class="nc" id="L241">		 return false;</span>
		} 	 
<span class="fc" id="L243">	 return true;	 </span>
 }
 
	public static Boolean SetOverdue(Integer reservationID, Integer user_id) {
<span class="fc" id="L247">	 Statement stmt = null;</span>
<span class="fc" id="L248">	 Connection conn = SQLConnection.getDBConnection();</span>
	 try{
<span class="fc" id="L250">			stmt=conn.createStatement();</span>
<span class="fc" id="L251">			String fetchqueryString=&quot;select OverStay from reservations where Reservation_Id=&quot;+reservationID+&quot;;&quot;;</span>
<span class="fc" id="L252">			ResultSet rs = stmt.executeQuery(fetchqueryString);</span>
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">			if(rs.next()) </span>
			{			
<span class="fc" id="L255">				int OverStay = rs.getInt(&quot;OverStay&quot;);</span>
<span class="fc bfc" id="L256" title="All 2 branches covered.">				if(OverStay == 0)</span>
				{
<span class="fc" id="L258">					OverStay = 1;</span>
<span class="fc" id="L259">				}</span>
				else
				{
<span class="fc" id="L262">					OverStay = 0;</span>
				}	
<span class="fc" id="L264">				String queryString=&quot;update reservations set OverStay=&quot;+OverStay+&quot; where Reservation_Id=&quot;+reservationID+&quot;;&quot;;</span>
<span class="fc" id="L265">				stmt.executeUpdate(queryString);</span>
<span class="fc" id="L266">				conn.commit();</span>
<span class="fc" id="L267">				String queryString1=&quot;select count(*) AS Count from reservations where reservations.User_Id=&quot;+user_id+&quot; and reservations.OverStay=1&quot;;</span>
<span class="fc" id="L268">				ResultSet count=stmt.executeQuery(queryString1);</span>
<span class="fc" id="L269">				count.next();</span>
<span class="fc" id="L270">				Integer totalCount = count.getInt(&quot;Count&quot;);</span>
<span class="fc bfc" id="L271" title="All 2 branches covered.">				if (totalCount&gt;0)</span>
				{
<span class="fc" id="L273">					String queryString2=&quot;Update System_users set isRevoked=1,comment=&quot; +&quot;'Overstayed'&quot;+&quot;  where user_id=&quot;+user_id+&quot;;&quot;;</span>
<span class="fc" id="L274">					stmt.executeUpdate(queryString2);</span>
<span class="fc" id="L275">				}</span>
				else
				{
<span class="fc" id="L278">					String queryString2=&quot;Update System_users set isRevoked=0,comment=&quot; +&quot;''&quot;+&quot;  where user_id=&quot;+user_id+&quot;;&quot;;</span>
<span class="fc" id="L279">					stmt.executeUpdate(queryString2);</span>
				}
<span class="fc" id="L281">				conn.commit();</span>
<span class="fc" id="L282">			}</span>
			else
			{
<span class="nc" id="L285">				System.out.println(&quot;Do Nothing.&quot;);</span>
			}
<span class="fc" id="L287">			conn.close();</span>
<span class="fc" id="L288">			stmt.close();</span>
<span class="pc" id="L289">	 }catch (SQLException e) {</span>
<span class="nc" id="L290">		 e.printStackTrace();</span>
<span class="nc" id="L291">		 return false;</span>
	 }	 
<span class="fc" id="L293">	 return true;</span>
}
	
	public static Boolean CheckRevoked(Integer user_id) {
<span class="fc" id="L297">		 Statement stmt = null;</span>
<span class="fc" id="L298">		 Connection conn = SQLConnection.getDBConnection();</span>
		 try{
<span class="fc" id="L300">				stmt=conn.createStatement();</span>
<span class="fc" id="L301">				String queryString=&quot;select IsRevoked AS Count from system_users where User_Id =&quot;+user_id+&quot;;&quot;;</span>
<span class="fc" id="L302">				ResultSet count=stmt.executeQuery(queryString);</span>
<span class="fc" id="L303">				count.next();</span>
<span class="fc" id="L304">				Integer isRevoked = count.getInt(&quot;Count&quot;);</span>
<span class="fc bfc" id="L305" title="All 2 branches covered.">				if(isRevoked == 0){</span>
<span class="fc" id="L306">					conn.close();</span>
<span class="fc" id="L307">					stmt.close();</span>
<span class="fc" id="L308">					return false;</span>
				}
				else
				{
<span class="fc" id="L312">					conn.close();</span>
<span class="fc" id="L313">					stmt.close();</span>
<span class="fc" id="L314">					return true;</span>
				}								
<span class="nc" id="L316">		 }catch (SQLException e)</span>
		 {
<span class="nc" id="L318">			 e.printStackTrace();</span>
<span class="nc" id="L319">			 return false;</span>
		 }
	}
	public static ArrayList&lt;ReservationsHelper&gt; GetReservationsByUserId (Integer user_id) {
<span class="fc" id="L323">	ArrayList&lt;ReservationsHelper&gt; ReservationsById = new ArrayList&lt;ReservationsHelper&gt;();</span>
<span class="fc" id="L324">	Statement stmt = null;</span>
<span class="fc" id="L325">	Connection conn = SQLConnection.getDBConnection();</span>
	try{
<span class="fc" id="L327">		stmt=conn.createStatement();</span>
<span class="fc" id="L328">		String queryString=&quot;SELECT r.Reservation_Id,s.UserName,s_u.LastName,p_a.Area_Name, p.Floor_Number,p.Spot_Id,r.Start_Time,r.End_Time,r.NoShow,r.OverStay &quot;</span>
						+&quot;from reservations as r &quot;
						+&quot;Inner join system_users as s on r.User_ID=s.User_ID &quot;
						+&quot;Inner join user_details as s_u on r.User_ID=s_u.User_ID &quot;
						+&quot;Inner join parking_spots as p on r.Spot_UID=p.Spot_UID &quot;
						+&quot;Inner join parking_area as p_a on p.Area_Id=p_a.Area_Id &quot;
<span class="fc" id="L334">						+&quot;where s.User_Id =&quot;+user_id+&quot;;&quot;;</span>
<span class="fc" id="L335">		ResultSet reservationList = stmt.executeQuery(queryString);</span>
<span class="fc bfc" id="L336" title="All 2 branches covered.">		while (reservationList.next()) {</span>
<span class="fc" id="L337">			ReservationsHelper reservation = new ReservationsHelper();</span>
<span class="fc" id="L338">			reservation.setReservationID(reservationList.getInt(&quot;Reservation_Id&quot;));</span>
<span class="fc" id="L339">			reservation.setUserName(reservationList.getString(&quot;UserName&quot;));</span>
<span class="fc" id="L340">			reservation.setLastName(reservationList.getString(&quot;LastName&quot;));</span>
<span class="fc" id="L341">			reservation.setAreaName(reservationList.getString(&quot;Area_Name&quot;));</span>
<span class="fc" id="L342">			reservation.setFloor_Number(reservationList.getInt(&quot;Floor_Number&quot;));</span>
<span class="fc" id="L343">			reservation.setSpot_Id(reservationList.getInt(&quot;Spot_Id&quot;));</span>
<span class="fc" id="L344">			reservation.setStart_Time(reservationList.getString(&quot;Start_Time&quot;));</span>
<span class="fc" id="L345">			reservation.setEnd_Time(reservationList.getString(&quot;End_Time&quot;));</span>
<span class="fc" id="L346">			reservation.setisNoShow(reservationList.getInt(&quot;NoShow&quot;));</span>
<span class="fc" id="L347">			reservation.setisOverDue(reservationList.getInt(&quot;OverStay&quot;));</span>
<span class="fc" id="L348">			ReservationsById.add(reservation);</span>
		
		}
<span class="fc" id="L351">		conn.close();</span>
<span class="fc" id="L352">		stmt.close();</span>
<span class="pc" id="L353">	}catch (SQLException e) {</span>
<span class="nc" id="L354">		e.printStackTrace();</span>
	} 
<span class="fc" id="L356">	return ReservationsById;</span>
}

public static ArrayList&lt;ReservationsHelper&gt; GetReservationsViolations (String current_date, Integer user_id) {
<span class="fc" id="L360">	ArrayList&lt;ReservationsHelper&gt; ReservationsViolations = new ArrayList&lt;ReservationsHelper&gt;();</span>
<span class="fc" id="L361">	Statement stmt = null;</span>
<span class="fc" id="L362">	Connection conn = SQLConnection.getDBConnection();</span>
	try{
<span class="fc" id="L364">		stmt=conn.createStatement();</span>
<span class="fc" id="L365">		String queryString=&quot;SELECT r.Reservation_Id,s.UserName,s_u.LastName,p_a.Area_Name, p.Floor_Number,p.Spot_Id,r.Start_Time,r.End_Time,r.NoShow,r.OverStay &quot;</span>
						+&quot;from reservations as r &quot;
						+&quot;Inner join system_users as s on r.User_ID=s.User_ID &quot;
						+&quot;Inner join user_details as s_u on r.User_ID=s_u.User_ID &quot;
						+&quot;Inner join parking_spots as p on r.Spot_UID=p.Spot_UID &quot;
						+&quot;Inner join parking_area as p_a on p.Area_Id=p_a.Area_Id &quot;
<span class="fc" id="L371">						+&quot;where r.End_Time &lt;='&quot;+current_date+&quot;' &quot;</span>
<span class="fc" id="L372">						+ &quot;And (r.NoShow=1 or r.OverStay=1) &quot;</span>
<span class="fc" id="L373">						+&quot;And s.User_Id=&quot;+user_id+&quot;;&quot;;</span>
<span class="fc" id="L374">		ResultSet reservationList = stmt.executeQuery(queryString);</span>
<span class="fc bfc" id="L375" title="All 2 branches covered.">		while (reservationList.next()) {</span>
<span class="fc" id="L376">			ReservationsHelper reservation = new ReservationsHelper();</span>
<span class="fc" id="L377">			reservation.setReservationID(reservationList.getInt(&quot;Reservation_Id&quot;));</span>
<span class="fc" id="L378">			reservation.setUserName(reservationList.getString(&quot;UserName&quot;));</span>
<span class="fc" id="L379">			reservation.setLastName(reservationList.getString(&quot;LastName&quot;));</span>
<span class="fc" id="L380">			reservation.setAreaName(reservationList.getString(&quot;Area_Name&quot;));</span>
<span class="fc" id="L381">			reservation.setFloor_Number(reservationList.getInt(&quot;Floor_Number&quot;));</span>
<span class="fc" id="L382">			reservation.setSpot_Id(reservationList.getInt(&quot;Spot_Id&quot;));</span>
<span class="fc" id="L383">			reservation.setStart_Time(reservationList.getString(&quot;Start_Time&quot;));</span>
<span class="fc" id="L384">			reservation.setEnd_Time(reservationList.getString(&quot;End_Time&quot;));</span>
<span class="fc" id="L385">			reservation.setisNoShow(reservationList.getInt(&quot;NoShow&quot;));</span>
<span class="fc" id="L386">			reservation.setisOverDue(reservationList.getInt(&quot;OverStay&quot;));</span>
<span class="fc" id="L387">			ReservationsViolations.add(reservation);</span>
		
		}
<span class="fc" id="L390">		conn.close();</span>
<span class="fc" id="L391">		stmt.close();</span>
<span class="pc" id="L392">	}catch (SQLException e) {</span>
<span class="nc" id="L393">		e.printStackTrace();</span>
	} 
<span class="fc" id="L395">	return ReservationsViolations;</span>
}
 
	public static Integer CountReservationsInDay(Integer user_id){
<span class="fc" id="L399">		 Statement stmt = null;</span>
<span class="fc" id="L400">		 Connection conn = SQLConnection.getDBConnection();</span>
<span class="fc" id="L401">		 Integer totalCount=0;</span>
		 try{			 	
<span class="fc" id="L403">				stmt=conn.createStatement();</span>
<span class="fc" id="L404">				java.util.Date dt = new java.util.Date();</span>
<span class="fc" id="L405">				java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="fc" id="L406">				String currentTime = sdf.format(dt);</span>
<span class="fc" id="L407">				String queryString=&quot;select count(*) as Count &quot; </span>
						+&quot;from reservations &quot; 
<span class="fc" id="L409">						+&quot;where Start_Time&gt;='&quot;+currentTime+&quot;%' &quot;</span>
<span class="fc" id="L410">						+&quot;and User_Id=&quot;+user_id+&quot;;&quot;;		</span>
<span class="fc" id="L411">				ResultSet count=stmt.executeQuery(queryString);</span>
<span class="fc" id="L412">				count.next();</span>
<span class="fc" id="L413">				totalCount = count.getInt(&quot;Count&quot;);</span>
				
<span class="fc" id="L415">				conn.close();</span>
<span class="fc" id="L416">				stmt.close();</span>
<span class="pc" id="L417">		 }catch (SQLException e) </span>
		 {
<span class="nc" id="L419">			 e.printStackTrace();			 </span>
		 } 			
<span class="fc" id="L421">		return totalCount;		 </span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span>Merged (Apr 28, 2019 10:09:51 PM)</div></body></html>